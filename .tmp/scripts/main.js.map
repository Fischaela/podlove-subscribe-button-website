{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["/* globals $:false */\n'use strict';\n\n// Todo: refactor event listener functions\n// Todo: write docs\n// Todo: write tests\n$( document ).ready( function () {\n\n  window.podcastData = {\n    'title': 'Newz of the World',\n    'subtitle': 'Tim and Mark talk about the Newzâ„¢',\n    'description': 'Newz of the World is a weekly show about world news. Mark Fonseca Rendeiro and Tim Pritlove come together to present interesting reports and discuss their aspects and possible consequences. Newz of the world wants to be an alternative window to the common media flow and cherry picks interesting developments for you.',\n    'cover': 'https://meta.metaebene.me/media/newz/newz-logo-600x600.jpg',\n    'feeds': [\n      {\n        'type': 'audio',\n        'format': 'mp3',\n        'url': 'http://newz-of-the-world.com/feed/mp3',\n        'variant': 'high'\n      },\n      {\n        'type': 'audio',\n        'format': 'aac',\n        'url': 'http://newz-of-the-world.com/feed/mp4',\n        'variant': 'high',\n        'directory-url-itunes': 'https://itunes.apple.com/de/podcast/newz-of-the-world/id492588543'\n      },\n      {\n        'type': 'audio',\n        'format': 'ogg',\n        'url': 'http://newz-of-the-world.com/feed/ogg',\n        'variant': 'high'\n      },\n      {\n        'type': 'audio',\n        'format': 'opus',\n        'url': 'http://newz-of-the-world.com/feed/opus',\n        'variant': 'high'\n      }\n    ]\n  };\n\n  var $button = $( '#live-button' ),\n    buttonConfig = {\n      'data-json-data': 'podcastData',\n      'data-language': 'en',\n      'data-size': 'big',\n      'data-color': '#469cd1',\n      'data-format': 'cover',\n      'data-style': 'filled'\n    },\n    $generatorAddFeed = $( '#generator-add-feed' ),\n    $generatorModal = $( '#generator-modal' ),\n    $generatorSubmit = $( '#generator-submit' ),\n    $openGeneratorButton = $( '#generator-open' ),\n    $generatorClipboardButton = $( '#generator-copy-clipboard' );\n\n  function generateScript ( object ) {\n    var script = document.createElement( 'script' );\n\n    script.type = 'text/javascript';\n    script.src = 'https://cdn.podlove.org/subscribe-button/javascripts/app.js';\n    script.className = 'podlove-subscribe-button';\n\n    $.each( object, function ( key, value ) {\n      script.setAttribute( key, value );\n    } );\n    return script;\n  }\n\n  function updateButtonInfo () {\n    var $iframe = $button.find( 'iframe' ),\n      $widthElement = $( '#live-info-width' ),\n      width = null,\n      $heightElement = $( '#live-info-height' ),\n      height = null;\n\n    // to prevent info from showing false values while iframe is loading and resizing\n    if ( !$iframe.width() || $iframe.width() > 200 ) {\n      setTimeout( function () {\n        updateButtonInfo();\n      }, 2000 );\n      return;\n    }\n\n    width = $iframe.width() + 'px';\n    height = $iframe.height() + 'px';\n\n    $widthElement.text( width );\n    $heightElement.text( height );\n  }\n\n  function addButton () {\n    var script = generateScript( buttonConfig );\n    $button.html( script );\n    setTimeout( function () {\n      updateButtonInfo();\n    }, 1200 );\n  }\n\n  function addFeedInputFields ( e ) {\n    var feeds = $( '.generator__form__feed' ),\n      feedsCount = feeds.length,\n      $newFormElement;\n    console.log(feedsCount);\n    e.preventDefault();\n    $newFormElement = $( '#podcast-feed-0' ).clone().attr( 'id', 'podcast-feed-' + feedsCount ).insertAfter( '#podcast-feed-' + ( feedsCount - 1 ) );\n    // rename children\n    $newFormElement.find( '.generator__form__select__field--type-js' ).attr( 'id', 'podcast-feed-' + feedsCount + '-type' );\n    $newFormElement.find( '.generator__form__select__field--format-js' ).attr( 'id', 'podcast-feed-' + feedsCount + '-format' );\n    $newFormElement.find( '.generator__form__input--path-js' ).attr( 'id', 'podcast-feed-' + feedsCount + '-path' );\n  }\n\n  function changeButtonStyle ( style ) {\n    buttonConfig[ 'data-style' ] = style;\n    addButton();\n  }\n\n  function changeButtonColor ( color ) {\n    buttonConfig[ 'data-color' ] = color;\n    addButton();\n  }\n\n  function changeButtonFormat ( format ) {\n    buttonConfig[ 'data-format' ] = format;\n    addButton();\n  }\n\n  function changeButtonImage ( image ) {\n    window.podcastData.cover = image;\n    addButton();\n  }\n\n  function changeButtonLanguage ( language ) {\n    buttonConfig[ 'data-language' ] = language;\n    addButton();\n  }\n\n  function changeButtonSize ( size ) {\n    buttonConfig[ 'data-size' ] = size;\n    addButton();\n  }\n\n  function createScriptElement () {\n    var color = '',\n      format = '',\n      language = '',\n      scriptElement = '',\n      size = '',\n      style = '';\n\n    color = $('#color').val();\n    format = $('input[name=format]:checked').val();\n    language = $('.live__select__option:selected').val();\n    size = $('input[name=size]:checked').val();\n    style = $('input[name=style]:checked').val();\n\n    scriptElement = '<script class=\"podlove-subscribe-button\" src=\"https://cdn.podlove.org/subscribe-button/javascripts/app.js\" data-language=\"' + language + '\" data-size=\"' + size + '\" data-json-data=\"podcastData\" data-color=\"' + color + '\" data-format=\"' + format + '\" data-style=\"' + style + '\"></script>';\n\n    return scriptElement;\n  }\n\n  function eventTargetHandler ( e ) {\n    var target, value;\n\n    if ( typeof e.target === 'object' ) {\n      target = e.target;\n      if ( typeof target.value === 'string' ) {\n        value = target.value;\n      }\n    } else {\n      throw new Error( 'Input Event erroneous.' );\n    }\n\n    return value;\n  }\n\n  function closeGeneratorModal () {\n    $( 'html' ).css( 'overflow', 'auto' );\n    $( 'body' ).css( 'overflow', 'auto' );\n    $generatorModal.removeClass( 'modal--styled' );\n    window.setTimeout( function () {\n      $generatorModal.removeClass( 'modal--visible' );\n    }, 1000 );\n  }\n\n  function copyToClipboard ( e ) {\n    var target = e.target,\n      copyTarget = target.dataset.copytarget,\n      input = ( copyTarget ? document.querySelector( copyTarget ) : null ),\n      $message = $( '#generator-copy-message-success');\n\n    if ( input && input.select ) {\n      input.select();\n\n      try {\n        document.execCommand( 'copy' );\n        $message.addClass( 'generator__copy-message--visible' );\n      } catch ( err ) {\n        alert( 'Please press Ctrl/Cmd+C to copy.' );\n      }\n\n    }\n  }\n\n  function generateFeedObjectString (type, format, path) {\n    var feedObject = {};\n\n    feedObject.type = type;\n    feedObject.format = format;\n    feedObject.path = path;\n\n    return feedObject;\n  }\n\n  function handleGeneratorSubmit ( e ) {\n    var title = '',\n      subtitle = '',\n      description = '',\n      pathToCover = '',\n      jsonObject = {},\n      feeds = [],\n      feedsArray = [],\n      generatedString = '',\n      generatedScriptElement = '',\n      $outputElement = $( '#podcast-script-creation' ),\n      $buttonCreated = $( '#generator-subscribe-button-creation' ),\n      $creation = $( '#generator-creation' );\n\n    e.preventDefault();\n\n    title = $( '#podcast-title' ).val();\n    subtitle = $( '#podcast-subtitle' ).val();\n    description = $( '#podcast-description' ).val();\n    pathToCover = $( '#podcast-cover' ).val();\n\n    feeds = $( '.generator__form__feed' );\n    for ( var i = 0, max = feeds.length; i < max; i += 1 ) {\n      feedsArray[ i ] = generateFeedObjectString(\n        $( '#podcast-feed-' + i + '-type').val(),\n        $( '#podcast-feed-' + i + '-format').val(),\n        $( '#podcast-feed-' + i + '-path').val()\n      );\n    }\n\n    jsonObject.title = title;\n    jsonObject.subtitle = subtitle;\n    jsonObject.description = description;\n    jsonObject.cover = pathToCover;\n    jsonObject.feeds = feedsArray;\n\n    generatedScriptElement = createScriptElement();\n\n    generatedString = '<script>window.podcastData=' + JSON.stringify(jsonObject) + '</script>' + generatedScriptElement + '<noscript><a href=\"' + feedsArray[ 0 ].path + '\">Subscribe to feed</a></noscript>';\n\n    $creation.addClass( 'generator__creation--visible' );\n    $outputElement.val(generatedString);\n    $outputElement.trigger('autoresize');\n    $outputElement.select();\n    $buttonCreated.html(generatedString);\n  }\n\n  function initForms () {\n    // $( 'select' ).material_select();\n  }\n\n  function openGeneratorModal () {\n    $( 'html' ).css( 'overflow', 'hidden' );\n    $( 'body' ).css( 'overflow', 'hidden' );\n    $generatorModal.addClass( 'modal--visible' );\n    window.setTimeout( function () {\n      $generatorModal.addClass( 'modal--styled' );\n    }, 100 );\n  }\n\n  function addColorListener () {\n    var $colorInput = $( '#color' );\n\n    $colorInput.bind( 'input', function ( e ) {\n      var color = eventTargetHandler( e );\n      changeButtonColor( color );\n    } );\n  }\n\n  function addFormatListener () {\n    var $formatInput = $( 'input[name=format]' );\n\n    $formatInput.on( 'change', function ( e ) {\n      var format = eventTargetHandler( e );\n      changeButtonFormat( format );\n    } );\n  }\n\n  function addImageListener () {\n    var $imageInput = $( 'input[name=podcast-cover]' );\n\n    $imageInput.focusout( function ( e ) {\n      var image = eventTargetHandler( e );\n      changeButtonImage( image );\n    } );\n  }\n\n  function addLanguageListener () {\n    var $languageInput = $( '#language' );\n\n    $languageInput.on( 'change', function ( e ) {\n      var language = eventTargetHandler( e );\n      changeButtonLanguage( language );\n    } );\n  }\n\n  function addModalListener () {\n    $generatorModal.on( 'click', function () {\n      closeGeneratorModal();\n    } ).children().on( 'click', function ( e ) {\n      e.stopPropagation();\n    } );\n\n    $openGeneratorButton.on( 'click', function () {\n      openGeneratorModal();\n    } );\n\n    $generatorSubmit.on( 'click', function ( e ) {\n      handleGeneratorSubmit( e );\n    } );\n\n    $( document ).on( 'keyup', function ( e ) {\n      if (e.keyCode === 27 ) {\n        closeGeneratorModal();\n      }\n    });\n\n    $generatorAddFeed.on( 'click', function ( e ) {\n      addFeedInputFields( e );\n    } );\n  }\n\n  function addSizeListener () {\n    var $sizeInput = $( 'input[name=size]' );\n\n    $sizeInput.on( 'change', function ( e ) {\n      var size = eventTargetHandler( e );\n      changeButtonSize( size );\n    } );\n  }\n\n  function addStyleListener () {\n    var $styleInput = $( 'input[name=style]' );\n\n    $styleInput.on( 'change', function ( e ) {\n      var style = eventTargetHandler( e );\n      changeButtonStyle( style );\n    } );\n  }\n\n  function addCopyToClipboardListener () {\n    $generatorClipboardButton.on( 'click', function ( e ) {\n      copyToClipboard( e );\n    } );\n  }\n\n  function init () {\n    addButton( 'red' );\n    addColorListener();\n    addStyleListener();\n    addFormatListener();\n    addImageListener();\n    addLanguageListener();\n    addModalListener();\n    addSizeListener();\n    addCopyToClipboardListener();\n    initForms();\n  }\n\n  init();\n\n} );\n"],"file":"main.js","sourceRoot":"/source/"}